<?xml version="1.0" encoding="UTF-8"?>
<project name="SchedVis" default="run" basedir=".">
  <property name="dir.bin" value="./bin" />
	<property name="dir.build" value="./build" />
  <property name="dir.src" value="./src" />
	<property name="dir.lib" value="./lib" />
  <path id="dir.lib.native" path="${dir.lib}/i386" />
  <path id="classpath.base">
    <fileset dir="${dir.lib}">
      <include name="**/*.jar"/>
    </fileset>
  </path>
  <path id="classpath.build">
  	<path refid="classpath.base" />
    <pathelement location="${dir.src}" />
  </path>
  <path id="classpath.runtime">
    <path refid="classpath.base" />
    <fileset dir="${dir.bin}">
      <include name="*.jar"/>
    </fileset>
  </path>
	
	<target name="makejar" description="Create a jar for the SchedVis project">
    <mkdir dir="${dir.bin}" />
		<copy file="${dir.src}/log4j.xml" todir="${dir.build}" />
    <copy todir="${dir.build}/META-INF">
    	<fileset dir="${dir.src}/META-INF" />
    </copy>
	  <jar jarfile="${dir.bin}/SchedVis.jar" basedir="${dir.build}">
	  	<manifest>
	  		<attribute name="Main-Class" value="cz.muni.fi.spc.SchedVis.Main" />  	  
	  	</manifest>
	  </jar>
	</target>
	<target name="makedoc" description="Generate source code documentation.">
		<javadoc source="1.5" classpathref="classpath.build" sourcepath="src" destdir="doc/api" author="true" use="true" windowtitle="SchedVis API">
		    <tag name="todo" scope="all" description="To do:"/>
	  </javadoc>
	</target>
	<target name="compile" description="Compile the classes.">
	  <mkdir dir="${dir.build}" />
		<javac debug="true" srcdir="${dir.src}" destdir="${dir.build}" classpathref="classpath.build" source="1.5" nowarn="true" includeJavaRuntime="true" />
	</target>
	<target name="build" description="Build the SchedVis project" depends="clean,compile,makejar,makedoc" />
	<target name="clean" description="Restore the distribution to its default state.">
		<delete dir="${dir.bin}" />
    <delete dir="${dir.build}" />
  </target>
	<target name="run" description="Run the program.">
		<java dir="./" classname="cz.muni.fi.spc.SchedVis.Main" classpathref="classpath.runtime" newenvironment="true" fork="true" spawn="true">
			<sysproperty key="SQLite.library.path" value="${toString:dir.lib.native}"/>
		</java>
  </target>
  <target name="bottom-up" description="Build it and run." depends="build,run" />
</project>